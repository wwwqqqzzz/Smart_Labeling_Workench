# 智能打标便捷器 - 项目概述

## 📋 项目背景

### 当前痛点

在货运对话数据标注工作中，我们面临以下问题：

1. **对话格式混乱**
   - 原始数据使用 `$_$` 分割司机和货主对话
   - 难以快速识别谁说了什么
   - 关键信息淹没在长文本中

2. **人工审核效率低**
   - 单条对话审核时间：3-5 分钟
   - 3500 条对话需要 20-30 小时
   - 长时间工作导致准确率下降

3. **标签定义难记**
   - 56 个标准化标签，定义复杂
   - 需要频繁查阅 Excel 中的备注说明
   - 边界情况难以判断

4. **AI 标签验证困难**
   - AI 自动打标存在错误
   - 人工逐条验证耗时耗力
   - 缺乏智能辅助判断

### 数据现状

基于 `1.xlsx` 的数据分析：

- **对话数量**: 3,500 条
- **标签数量**: 56 个标准化标签
- **平均长度**: 556 字符/条
- **标签分布**: 单标签 68%，双标签 21%，多标签 11%
- **已审核**: 100%（01 期已完成）

## 🎯 项目目标

### 核心目标

**提升人工审核效率 5-10 倍，同时保持或提高准确率**

### 具体指标

| 指标 | 当前 | 目标 | 提升 |
|------|------|------|------|
| 单条审核时间 | 3-5 分钟 | 20-30 秒 | **6-10x** |
| 准确率 | 95% | ≥95% | **保持** |
| 审核人员疲劳度 | 高（2小时后下降） | 低（可持续工作） | **显著降低** |

### 关键原则

**宁可不打，也不能打错**

## 💡 解决方案

### 方案概述

构建一个基于 **RAG（检索增强生成）** 的智能打标便捷器，通过以下方式提升效率：

#### 1. 对话还原（P0）
- 将 `$_$` 格式自动转换为对话气泡
- 司机对话：绿色，右对齐，🚚 头像
- 货主对话：白色，左对齐，👤 头像
- 关键词自动高亮（红色背景）

#### 2. 智能推荐（P0）
- **RAG 引擎**：基于对话内容检索相关标签定义
- **LLM 判断**：验证 AI 标签是否正确，给出置信度
- **Top 3 推荐**：推荐最可能的 3 个标签

#### 3. 快速操作（P0）
- **快捷键支持**：
  - `空格`：确认 AI 标签
  - `1-3`：选择 RAG 推荐
  - `Enter`：跳过（存疑）
- **标签速选池**：56 个标签按分类平铺，点击即录入
- **自动跳转**：提交后自动加载下一条

#### 4. 标签定义随手查（P1）
- 鼠标悬停标签显示定义
- 选中对话文字自动搜索相关标签
- 疑难案例知识库推荐

## 🏗️ 技术架构

### 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                   前端 (Next.js 15)                       │
│  - 对话气泡组件                                          │
│  - 标签选择器                                            │
│  - 快捷键支持                                            │
└─────────────────────────────────────────────────────────┘
                           ↕ HTTP API
┌─────────────────────────────────────────────────────────┐
│                  后端 API (FastAPI)                       │
│  - 对话数据接口                                          │
│  - 标签提交接口                                          │
│  - RAG 推荐接口                                          │
└─────────────────────────────────────────────────────────┘
                           ↕
┌──────────────────────┬──────────────────┬──────────────┐
│  SQLite (数据存储)   │  Chroma (向量库)  │  GLM-4 (LLM) │
│  - 对话表            │  - 标签定义向量   │  - 标签判断   │
│  - 标签表            │  - 语义检索       │  - 推理生成   │
│  - 审核记录表        │  - 相似度计算     │              │
└──────────────────────┴──────────────────┴──────────────┘
```

### 技术栈

| 层级 | 技术选择 | 理由 |
|------|---------|------|
| **前端** | Next.js 15 + shadcn/ui | 现代、可维护、组件可定制 |
| **后端** | FastAPI + SQLAlchemy | 快速开发、类型安全、自动文档 |
| **AI** | GLM-4 Flash + LangChain | 便宜、快、中文友好 |
| **向量库** | Chroma | 本地、免费、够用 |
| **嵌入** | OpenAI text-embedding-3-small | 准确、便宜（$0.02/1M tokens） |
| **数据库** | SQLite | 本地开发、零配置 |
| **部署** | Docker + docker-compose | 一键启动、环境隔离 |

## 📊 功能优先级

### P0 - 核心功能（第 1-2 周）

- ✅ 对话气泡展示（司机/货主区分）
- ✅ 关键词高亮（基于规则）
- ✅ AI 标签展示 + 确认/修改/跳过
- ✅ 标签速选池（56 个标签平铺）
- ✅ Excel 导入/导出

**验收标准**：单条审核时间 < 1 分钟

### P1 - 智能辅助（第 3-4 周）

- ✅ RAG 推荐引擎（向量检索 + LLM 判断）
- ✅ 置信度显示
- ✅ Top 3 标签推荐
- ✅ 快捷键支持（空格、1-3、Enter）
- ✅ 标签定义浮窗（悬停显示）

**验收标准**：单条审核时间 < 30 秒，RAG 准确率 > 85%

### P2 - 体验优化（第 5-6 周）

- ✅ 疑难案例知识库
- ✅ 标签定义随手查（选中文字搜索）
- ✅ 进度管理（已审核/未审核/存疑）
- ✅ 数据统计面板（审核速度、准确率）
- ✅ 性能优化（预加载、缓存）

**验收标准**：RAG 准确率 > 90%，用户体验流畅

## 🚀 实施计划

### 第 1 周：基础框架搭建

- [ ] 初始化前后端项目
- [ ] 设计数据库表结构
- [ ] 实现 Excel 数据导入
- [ ] 实现对话气泡展示

### 第 2 周：核心审核功能

- [ ] 实现标签选择器
- [ ] 实现确认/修改/跳过功能
- [ ] 实现数据持久化
- [ ] 实现 Excel 导出

### 第 3 周：RAG 引擎开发

- [ ] 构建标签定义向量库
- [ ] 实现向量检索
- [ ] 集成 GLM-4 API
- [ ] 实现 RAG 推荐逻辑

### 第 4 周：前后端集成

- [ ] API 对接
- [ ] 实现 RAG 推荐展示
- [ ] 实现快捷键支持
- [ ] 测试和调试

### 第 5 周：优化和完善

- [ ] 性能优化
- [ ] 疑难案例功能
- [ ] 标签定义随手查
- [ ] UI/UX 优化

### 第 6 周：测试和上线

- [ ] 完整功能测试
- [ ] 性能测试
- [ ] 编写用户文档
- [ ] 部署上线

## 📈 预期收益

### 效率提升

- **01 期（3500 条）**：人工审核需要 20-30 小时
- **使用便捷器后**：预计 4-6 小时
- **时间节省**：75-80%

### 质量保证

- **RAG 辅助判断**：减少人为错误
- **标签定义提示**：避免边界情况误判
- **存疑机制**：不确定的留待专家审核

### 可扩展性

- **新数据导入**：一键导入新的 Excel
- **标签体系更新**：支持动态添加标签
- **多人协作**：支持多人并行审核

## 🎓 项目特色

1. **极简交互**：单手操作，快捷键驱动
2. **智能辅助**：RAG + LLM 双重保障
3. **零学习成本**：微信式对话，一目了然
4. **本地优先**：数据不上云，安全可控
5. **渐进增强**：P0 不用 RAG 也能用，P1 加 RAG 更智能

---

**项目名称**: 智能打标便捷器 (Smart Labeling Workbench)
**技术栈**: Next.js + FastAPI + GLM-4 + Chroma
**开发周期**: 6 周
**最后更新**: 2025-01-13
