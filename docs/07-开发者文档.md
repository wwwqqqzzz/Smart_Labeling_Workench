# æ™ºèƒ½æ‰“æ ‡ä¾¿æ·å™¨ - å¼€å‘è€…æ–‡æ¡£

**ç‰ˆæœ¬**: v0.1.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-13
**æŠ€æœ¯æ ˆ**: Next.js 15 + FastAPI + Python 3.11 + SQLite

---

## ğŸ“– ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [ç¯å¢ƒæ­å»º](#ç¯å¢ƒæ­å»º)
3. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [APIæ–‡æ¡£](#apiæ–‡æ¡£)
6. [RAGæ¨èå¼•æ“](#ragæ¨èå¼•æ“)
7. [å‰ç«¯ç»„ä»¶](#å‰ç«¯ç»„ä»¶)
8. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
9. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ (Next.js)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React Query â”‚  â”‚  shadcn/ui   â”‚  â”‚ Tailwind  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/JSON
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯ (FastAPI)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   SQLAlchemy â”‚  â”‚   Pydantic   â”‚  â”‚   Uvicorn â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SQLite     â”‚    â”‚  Chroma DB    â”‚    â”‚  GLM-4 API  â”‚
â”‚  (ä¸»æ•°æ®åº“)   â”‚    â”‚  (å‘é‡æ•°æ®åº“)  â”‚    â”‚  (AIæ¨¡å‹)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

**å‰ç«¯**:
- Next.js 15 (App Router)
- React 19
- TypeScript 5
- Tailwind CSS 3.4
- shadcn/ui
- React Query (@tanstack/react-query)
- Zustand (çŠ¶æ€ç®¡ç†)

**åç«¯**:
- FastAPI 0.109+
- Python 3.11
- SQLAlchemy 2.0 (ORM)
- Pydantic v2 (æ•°æ®éªŒè¯)
- Uvicorn (ASGIæœåŠ¡å™¨)

**AI/ML**:
- GLM-4 Flash (æ™ºè°±AI)
- LangChain (RAGæ¡†æ¶)
- Chroma (å‘é‡æ•°æ®åº“)
- OpenAI text-embedding-3-small (åµŒå…¥æ¨¡å‹)

**DevOps**:
- Docker & Docker Compose
- Git
- SQLite (å¼€å‘ç¯å¢ƒ)

---

## ç¯å¢ƒæ­å»º

### å‰ç½®è¦æ±‚

- **Node.js**: 18.x æˆ–æ›´é«˜
- **Python**: 3.11 æˆ–æ›´é«˜
- **Docker**: 20.x æˆ–æ›´é«˜
- **Git**: æœ€æ–°ç‰ˆæœ¬

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd Smart-Labeling-Workbench
```

### 2. åç«¯ç¯å¢ƒæ­å»º

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦çš„é…ç½®

# åˆå§‹åŒ–æ•°æ®åº“
python scripts/init_db.py

# ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
python scripts/generate_test_data.py 50
```

### 3. å‰ç«¯ç¯å¢ƒæ­å»º

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.local.example .env.local
# ç¼–è¾‘ .env.local æ–‡ä»¶ï¼Œé…ç½®åç«¯APIåœ°å€

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### 4. Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### ç¯å¢ƒå˜é‡è¯´æ˜

**åç«¯ `.env`**:
```bash
# æ•°æ®åº“
DATABASE_URL=sqlite:///./data/conversations.db

# API Keys
GLM_API_KEY=your_glm_api_key_here
OPENAI_API_KEY=your_openai_api_key_here  # ç”¨äºåµŒå…¥æ¨¡å‹

# åº”ç”¨é…ç½®
APP_NAME=æ™ºèƒ½æ‰“æ ‡ä¾¿æ·å™¨
VERSION=0.1.0
DEBUG=True

# CORS
BACKEND_CORS_ORIGINS=["http://localhost:3000","http://localhost:3002"]
```

**å‰ç«¯ `.env.local`**:
```bash
NEXT_PUBLIC_API_URL=http://localhost:8000
```

---

## é¡¹ç›®ç»“æ„

```
smart-labeling-workbench/
â”œâ”€â”€ backend/                    # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPIåº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ models/            # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tag.py
â”‚   â”‚   â”‚   â””â”€â”€ audit_log.py
â”‚   â”‚   â”œâ”€â”€ schemas/           # Pydanticæ¨¡å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.py
â”‚   â”‚   â”‚   â””â”€â”€ tag.py
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ rag/           # RAGæœåŠ¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rag_service.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ embeddings.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ vector_store.py
â”‚   â”‚   â”‚   â””â”€â”€ data_importer.py
â”‚   â”‚   â””â”€â”€ api/               # APIè·¯ç”±
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ v1/
â”‚   â”‚           â”œâ”€â”€ __init__.py
â”‚   â”‚           â”œâ”€â”€ conversations.py
â”‚   â”‚           â”œâ”€â”€ tags.py
â”‚   â”‚           â”œâ”€â”€ export.py
â”‚   â”‚           â”œâ”€â”€ import.py
â”‚   â”‚           â””â”€â”€ recommendations.py
â”‚   â”œâ”€â”€ scripts/               # å·¥å…·è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ init_db.py         # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ import_excel.py    # Excelå¯¼å…¥
â”‚   â”‚   â””â”€â”€ generate_test_data.py  # ç”Ÿæˆæµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile             # Dockeré•œåƒ
â”‚   â””â”€â”€ pyproject.toml         # é¡¹ç›®é…ç½®
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx           # é¦–é¡µï¼ˆä¸»ç•Œé¢ï¼‰
â”‚   â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                # shadcn/uiç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ conversation-bubble.tsx    # å¯¹è¯æ°”æ³¡
â”‚   â”‚   â”œâ”€â”€ conversation-view.tsx      # å¯¹è¯å±•ç¤ºåŒº
â”‚   â”‚   â”œâ”€â”€ tag-selector.tsx           # æ ‡ç­¾é€‰æ‹©å™¨
â”‚   â”‚   â”œâ”€â”€ recommendation-panel.tsx   # æ¨èé¢æ¿
â”‚   â”‚   â”œâ”€â”€ audit-progress.tsx         # è¿›åº¦ç»Ÿè®¡
â”‚   â”‚   â””â”€â”€ difficult-case-marker.tsx  # ç–‘éš¾æ¡ˆä¾‹æ ‡è®°
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ parser.ts          # å¯¹è¯è§£æ
â”‚   â”‚   â”œâ”€â”€ highlight.ts       # å…³é”®è¯é«˜äº®
â”‚   â”‚   â”œâ”€â”€ api.ts             # APIè°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ constants.ts       # å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ tag-definitions.ts # æ ‡ç­¾å®šä¹‰
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-conversation.ts      # å¯¹è¯ç›¸å…³hooks
â”‚   â”‚   â””â”€â”€ use-keyboard-shortcuts.ts # å¿«æ·é”®hooks
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts           # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ next.config.js
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ conversations.db        # SQLiteæ•°æ®åº“
â”‚   â”œâ”€â”€ chroma/                # Chromaå‘é‡åº“
â”‚   â””â”€â”€ uploads/               # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ 01-é¡¹ç›®æ¦‚è¿°.md
â”‚   â”œâ”€â”€ 02-æŠ€æœ¯æ¶æ„è®¾è®¡.md
â”‚   â”œâ”€â”€ 03-æ•°æ®æµç¨‹ä¸RAGå®ç°.md
â”‚   â”œâ”€â”€ 04-å®æ–½è®¡åˆ’.md
â”‚   â”œâ”€â”€ 05-åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š.md
â”‚   â”œâ”€â”€ 06-ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ.md
â”‚   â””â”€â”€ 07-å¼€å‘è€…æ–‡æ¡£.md
â”‚
â”œâ”€â”€ docker-compose.yml          # Dockerç¼–æ’
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## æ•°æ®åº“è®¾è®¡

### ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   conversations  â”‚       â”‚       tags       â”‚       â”‚    audit_logs   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚       â”‚ id (PK)          â”‚       â”‚ id (PK)          â”‚
â”‚ raw_text         â”‚       â”‚ name             â”‚       â”‚ conversation_id â”‚
â”‚ driver_tag       â”‚       â”‚ category         â”‚       â”‚ auditor          â”‚
â”‚ manual_tag       â”‚       â”‚ definition       â”‚       â”‚ action           â”‚
â”‚ status           â”‚       â”‚ created_at       â”‚       â”‚ old_status       â”‚
â”‚ field_length     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ new_status       â”‚
â”‚ is_difficult     â”‚                                  â”‚ created_at       â”‚
â”‚ difficult_note   â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ created_at       â”‚
â”‚ updated_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¡¨ç»“æ„

#### 1. conversationsï¼ˆå¯¹è¯è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|------|------|------|------|
| id | Integer | ä¸»é”® | âœ… |
| raw_text | Text | åŸå§‹å¯¹è¯æ–‡æœ¬ | - |
| driver_tag | String(500) | AIæ ‡ç­¾ï¼ˆJSONï¼‰ | - |
| manual_tag | String(500) | äººå·¥æ ‡ç­¾ï¼ˆJSONï¼‰ | - |
| status | String(20) | çŠ¶æ€: pending/approved/skipped | âœ… |
| field_length | Integer | å¯¹è¯é•¿åº¦ | - |
| is_difficult | Boolean | æ˜¯å¦ç–‘éš¾æ¡ˆä¾‹ | âœ… |
| difficult_note | Text | ç–‘éš¾æ¡ˆä¾‹å¤‡æ³¨ | - |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | âœ… |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ | - |

**å¤åˆç´¢å¼•**:
- `ix_conversations_status_updated`: (status, updated_at)

#### 2. tagsï¼ˆæ ‡ç­¾è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| name | String(100) | æ ‡ç­¾åç§°ï¼ˆå”¯ä¸€ï¼‰ |
| category | String(50) | æ ‡ç­¾åˆ†ç±» |
| definition | Text | æ ‡ç­¾å®šä¹‰ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |

#### 3. audit_logsï¼ˆå®¡æ ¸è®°å½•è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| conversation_id | Integer | å¯¹è¯IDï¼ˆå¤–é”®ï¼‰ |
| auditor | String(100) | å®¡æ ¸äºº |
| action | String(20) | æ“ä½œ: approved/skipped |
| old_status | String(20) | åŸçŠ¶æ€ |
| new_status | String(20) | æ–°çŠ¶æ€ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |

---

## APIæ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8000`
- **APIç‰ˆæœ¬**: v1
- **æ•°æ®æ ¼å¼**: JSON
- **è®¤è¯**: æš‚æ— ï¼ˆå¾…å®ç°ï¼‰

### é€šç”¨å“åº”æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": { ... }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "detail": "é”™è¯¯ä¿¡æ¯"
}
```

---

### 1. å¯¹è¯ç›¸å…³ API

#### 1.1 è·å–å¯¹è¯åˆ—è¡¨

**æ¥å£**: `GET /api/v1/conversations`

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | Integer | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| limit | Integer | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20 |
| status | String | å¦ | çŠ¶æ€è¿‡æ»¤: pending/approved/skipped |

**å“åº”**:
```json
{
  "total": 50,
  "page": 1,
  "limit": 20,
  "items": [
    {
      "id": 1,
      "raw_text": "å¸æœºï¼šæ‚¨å¥½...",
      "driver_tag": "[\"å†·é“¾è½¦\",\"æ°´æœè¿è¾“\"]",
      "manual_tag": null,
      "status": "pending",
      "field_length": 97,
      "is_difficult": false,
      "difficult_note": null,
      "created_at": "2026-01-13T14:49:02",
      "updated_at": null
    }
  ]
}
```

---

#### 1.2 è·å–å•æ¡å¯¹è¯

**æ¥å£**: `GET /api/v1/conversations/{id}`

**å“åº”**:
```json
{
  "id": 1,
  "raw_text": "å¸æœºï¼šæ‚¨å¥½...",
  "driver_tag": "[\"å†·é“¾è½¦\",\"æ°´æœè¿è¾“\"]",
  "manual_tag": null,
  "status": "pending",
  "field_length": 97,
  "is_difficult": false,
  "difficult_note": null,
  "created_at": "2026-01-13T14:49:02",
  "updated_at": null
}
```

---

#### 1.3 æ›´æ–°å¯¹è¯

**æ¥å£**: `PUT /api/v1/conversations/{id}`

**è¯·æ±‚ä½“**:
```json
{
  "manual_tag": ["å†·é“¾è½¦", "æ°´æœè¿è¾“"],
  "status": "approved",
  "is_difficult": false,
  "difficult_note": null
}
```

**å“åº”**:
```json
{
  "id": 1,
  "manual_tag": "[\"å†·é“¾è½¦\",\"æ°´æœè¿è¾“\"]",
  "status": "approved",
  "updated_at": "2026-01-13T15:30:00"
}
```

---

### 2. æ ‡ç­¾ç›¸å…³ API

#### 2.1 è·å–æ‰€æœ‰æ ‡ç­¾

**æ¥å£**: `GET /api/v1/tags`

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| category | String | å¦ | æ ‡ç­¾åˆ†ç±»è¿‡æ»¤ |

**å“åº”**:
```json
[
  {
    "id": 1,
    "name": "å°¾æ¿è½¦",
    "category": "è½¦è¾†ç±»å‹",
    "definition": "å¸¦æœ‰å°¾æ¿ï¼ˆå‡é™å¹³å°ï¼‰çš„è´§è½¦...",
    "created_at": "2026-01-13T14:49:02"
  }
]
```

---

### 3. RAGæ¨è API

#### 3.1 æ¨èæ ‡ç­¾

**æ¥å£**: `POST /api/v1/recommendations/tags`

**è¯·æ±‚ä½“**:
```json
{
  "conversation_id": 1,
  "top_k": 3
}
```

æˆ–

```json
{
  "text": "å¸æœºï¼šæ‚¨å¥½ï¼Œæœ‰å†·é“¾è½¦å—ï¼Ÿ",
  "top_k": 3
}
```

**å“åº”**:
```json
{
  "success": true,
  "recommendations": ["å†·é“¾è½¦", "æ°´æœè¿è¾“", "çŸ­é€”"],
  "tag_scores": {
    "å†·é“¾è½¦": 0.95,
    "æ°´æœè¿è¾“": 0.85,
    "çŸ­é€”": 0.75
  },
  "similar_conversations": [
    {
      "conversation_id": 10,
      "text": "å¸æœºï¼š...",
      "tags": ["å†·é“¾è½¦", "æ°´æœè¿è¾“"],
      "similarity": 0.92
    }
  ],
  "confidence": 0.95
}
```

---

## RAGæ¨èå¼•æ“

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥å¯¹è¯æ–‡æœ¬ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡æœ¬åµŒå…¥ï¼ˆEmbeddingï¼‰â”‚
â”‚  OpenAI text-embeddingâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‘é‡ç›¸ä¼¼åº¦æœç´¢     â”‚
â”‚   Chroma Vector DB  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æå–ç›¸ä¼¼å¯¹è¯æ ‡ç­¾   â”‚
â”‚   LangChain         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿”å›æ¨èç»“æœ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä»£ç 

**æ–‡ä»¶**: `backend/app/services/rag/rag_service.py`

```python
from langchain_community.vectorstores import Chroma
from langchain_openai import OpenAIEmbeddings
from app.database import SessionLocal
from app.models import Conversation

class RAGRecommender:
    def __init__(self):
        self.embeddings = OpenAIEmbeddings(
            model="text-embedding-3-small",
            openai_api_key=settings.OPENAI_API_KEY
        )
        self.vector_store = Chroma(
            persist_directory="./data/chroma",
            embedding_function=self.embeddings
        )

    async def recommend_tags(self, conversation_id: int, top_k: int = 3):
        # 1. è·å–å¯¹è¯
        db = SessionLocal()
        conversation = db.query(Conversation).get(conversation_id)

        # 2. å‘é‡æœç´¢
        results = self.vector_store.similarity_search_with_score(
            conversation.raw_text,
            k=top_k
        )

        # 3. æå–æ ‡ç­¾
        similar_tags = []
        for doc, score in results:
            tags = json.loads(doc.metadata.get("tags", "[]"))
            similar_tags.extend(tags)

        # 4. è¿”å›æ¨è
        return {
            "recommendations": list(set(similar_tags)),
            "confidence": avg_score
        }
```

### å‘é‡æ•°æ®åº“åˆå§‹åŒ–

**æ–‡ä»¶**: `backend/scripts/init_vector_db.py`

```python
from app.services.rag.rag_service import get_rag_recommender
from app.database import SessionLocal
from app.models import Conversation

def init_vector_db():
    """åˆå§‹åŒ–å‘é‡æ•°æ®åº“"""
    db = SessionLocal()
    rag = get_rag_recommender()

    # è·å–æ‰€æœ‰å·²æ ‡æ³¨çš„å¯¹è¯
    conversations = db.query(Conversation).filter(
        Conversation.manual_tag.isnot(None)
    ).all()

    # æ·»åŠ åˆ°å‘é‡æ•°æ®åº“
    for conv in conversations:
        rag.vector_store.add_texts(
            texts=[conv.raw_text],
            metadatas=[{"tags": conv.manual_tag, "id": conv.id}]
        )

    print(f"âœ… å·²æ·»åŠ  {len(conversations)} æ¡å¯¹è¯åˆ°å‘é‡æ•°æ®åº“")
```

---

## å‰ç«¯ç»„ä»¶

### æ ¸å¿ƒç»„ä»¶

#### 1. ConversationBubbleï¼ˆå¯¹è¯æ°”æ³¡ï¼‰

**æ–‡ä»¶**: `frontend/components/conversation-bubble.tsx`

**åŠŸèƒ½**:
- å±•ç¤ºå•æ¡å¯¹è¯å†…å®¹
- åŒºåˆ†å¸æœº/è´§ä¸»è§’è‰²
- å…³é”®è¯é«˜äº®æ˜¾ç¤º

**Props**:
```typescript
interface ConversationBubbleProps {
  content: string      // å¯¹è¯å†…å®¹
  role: 'driver' | 'owner'  // è§’è‰²
}
```

---

#### 2. TagSelectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰

**æ–‡ä»¶**: `frontend/components/tag-selector.tsx`

**åŠŸèƒ½**:
- æ˜¾ç¤ºAIæ¨èæ ‡ç­¾
- æ‰‹åŠ¨æœç´¢æ ‡ç­¾
- æ ‡ç­¾æç¤ºä¿¡æ¯

**Props**:
```typescript
interface TagSelectorProps {
  recommendations: string[]      // æ¨èæ ‡ç­¾
  selectedTags: string[]         // å·²é€‰æ ‡ç­¾
  onTagToggle: (tag: string) => void
  onRefresh: () => void
  disabled?: boolean
}
```

---

#### 3. AuditProgressï¼ˆå®¡æ ¸è¿›åº¦ï¼‰

**æ–‡ä»¶**: `frontend/components/audit-progress.tsx`

**åŠŸèƒ½**:
- æ˜¾ç¤ºå®¡æ ¸è¿›åº¦ç»Ÿè®¡
- è®¡ç®—å®¡æ ¸é€Ÿåº¦
- é¢„è®¡å‰©ä½™æ—¶é—´

**Props**:
```typescript
interface AuditProgressProps {
  total: number
  pending: number
  approved: number
  skipped?: number
  startTime?: Date
}
```

---

### è‡ªå®šä¹‰Hooks

#### useConversation

**æ–‡ä»¶**: `frontend/hooks/use-conversation.ts`

**åŠŸèƒ½**:
- ç®¡ç†å¯¹è¯çŠ¶æ€
- å¤„ç†æ ‡ç­¾æäº¤
- è·³è¿‡/åˆ·æ–°æ“ä½œ

```typescript
export function useConversation() {
  const [currentConversation, setCurrentConversation] = useState<Conversation | null>(null)
  const [selectedTags, setSelectedTags] = useState<string[]>([])

  const submitAudit = async (status: 'approved' | 'skipped') => {
    // æäº¤é€»è¾‘
  }

  return {
    currentConversation,
    selectedTags,
    setSelectedTags,
    submitAudit
  }
}
```

---

#### useKeyboardShortcuts

**æ–‡ä»¶**: `frontend/hooks/use-keyboard-shortcuts.ts`

**åŠŸèƒ½**:
- æ³¨å†Œå¿«æ·é”®
- å¤„ç†é”®ç›˜äº‹ä»¶

```typescript
export function useKeyboardShortcuts({
  onApprove,
  onSkip,
  onSelectRecommendation,
  onRefresh,
  disabled = false
}: KeyboardShortcutsOptions)
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

#### Pythonï¼ˆåç«¯ï¼‰

- **PEP 8**: éµå¾ªPythonä»£ç è§„èŒƒ
- **ç±»å‹æ³¨è§£**: ä½¿ç”¨Pythonç±»å‹æç¤º
- **æ–‡æ¡£å­—ç¬¦ä¸²**: Googleé£æ ¼

```python
def get_conversation(
    conversation_id: int,
    db: Session = Depends(get_db)
) -> ConversationResponse:
    """
    è·å–å•æ¡å¯¹è¯

    Args:
        conversation_id: å¯¹è¯ID
        db: æ•°æ®åº“ä¼šè¯

    Returns:
        å¯¹è¯è¯¦æƒ…

    Raises:
        HTTPException: å¯¹è¯ä¸å­˜åœ¨æ—¶æŠ›å‡º404
    """
    pass
```

---

#### TypeScriptï¼ˆå‰ç«¯ï¼‰

- **ESLint**: éµå¾ªAirbnbè§„èŒƒ
- **å‘½åè§„èŒƒ**:
  - ç»„ä»¶: PascalCaseï¼ˆå¦‚ `ConversationBubble`ï¼‰
  - å‡½æ•°: camelCaseï¼ˆå¦‚ `fetchConversations`ï¼‰
  - å¸¸é‡: UPPER_SNAKE_CASEï¼ˆå¦‚ `API_URL`ï¼‰
  - ç±»å‹/æ¥å£: PascalCaseï¼ˆå¦‚ `Conversation`ï¼‰

```typescript
// âœ… å¥½çš„ç¤ºä¾‹
interface Conversation {
  id: number
  raw_text: string
  status: 'pending' | 'approved' | 'skipped'
}

async function fetchConversation(id: number): Promise<Conversation> {
  const response = await fetch(`${API_URL}/conversations/${id}`)
  return response.json()
}

// âŒ ä¸å¥½çš„ç¤ºä¾‹
interface conversation {}
const Fetch_conversation = () => {}
```

---

### Gitæäº¤è§„èŒƒ

ä½¿ç”¨ **Conventional Commits** è§„èŒƒï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç±»å‹ (type)**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

**ç¤ºä¾‹**:

```bash
feat(api): æ·»åŠ ç–‘éš¾æ¡ˆä¾‹æ ‡è®°æ¥å£

- æ–°å¢ is_difficult å’Œ difficult_note å­—æ®µ
- æ›´æ–° ConversationUpdate schema
- æ·»åŠ APIæ–‡æ¡£

Closes #123
```

---

### æµ‹è¯•è§„èŒƒ

#### åç«¯æµ‹è¯•

ä½¿ç”¨ `pytest`:

```python
def test_get_conversation(client, db):
    # åˆ›å»ºæµ‹è¯•æ•°æ®
    conv = Conversation(raw_text="æµ‹è¯•", status="pending")
    db.add(conv)
    db.commit()

    # æµ‹è¯•API
    response = client.get(f"/api/v1/conversations/{conv.id}")

    # æ–­è¨€
    assert response.status_code == 200
    assert response.json()["id"] == conv.id
```

#### å‰ç«¯æµ‹è¯•

ä½¿ç”¨ `Jest` + `React Testing Library`:

```typescript
test('renders conversation bubble', () => {
  render(<ConversationBubble content="ä½ å¥½" role="driver" />)
  expect(screen.getByText('ä½ å¥½')).toBeInTheDocument()
})
```

---

## éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²

#### 1. æ„å»ºé•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒ
docker build -t smart-labeling-backend ./backend

# æ„å»ºå‰ç«¯é•œåƒ
docker build -t smart-labeling-frontend ./frontend
```

#### 2. å¯åŠ¨æœåŠ¡

```bash
docker-compose up -d
```

#### 3. æŸ¥çœ‹æ—¥å¿—

```bash
# æ‰€æœ‰æœåŠ¡
docker-compose logs -f

# ç‰¹å®šæœåŠ¡
docker-compose logs -f backend
docker-compose logs -f frontend
```

---

### ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 1. ç¯å¢ƒå˜é‡

**åç«¯ `.env`**:
```bash
# ç”Ÿäº§æ•°æ®åº“ï¼ˆä½¿ç”¨PostgreSQLï¼‰
DATABASE_URL=postgresql://user:pass@host:5432/dbname

# API Keysï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
GLM_API_KEY=${GLM_API_KEY}
OPENAI_API_KEY=${OPENAI_API_KEY}

# ç”Ÿäº§é…ç½®
DEBUG=False
ALLOWED_HOSTS=["your-domain.com"]
```

#### 2. æ•°æ®åº“è¿ç§»

```bash
# ä½¿ç”¨PostgreSQLï¼ˆæ¨èï¼‰
docker-compose -f docker-compose.prod.yml up -d postgres

# è¿è¡Œè¿ç§»
alembic upgrade head
```

#### 3. åå‘ä»£ç†ï¼ˆNginxï¼‰

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://frontend:3000;
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://backend:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å‘é‡æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ï¼Ÿ

**ç­”**:
æ£€æŸ¥OpenAI API Keyæ˜¯å¦æ­£ç¡®é…ç½®ï¼š
```bash
export OPENAI_API_KEY=your_key_here
```

---

### Q2: å‰ç«¯æ— æ³•è¿æ¥åç«¯ï¼Ÿ

**ç­”**:
1. æ£€æŸ¥CORSé…ç½®
2. ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨
3. æ£€æŸ¥API URLé…ç½®

---

### Q3: Dockerå®¹å™¨æ— æ³•å¯åŠ¨ï¼Ÿ

**ç­”**:
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs backend

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build --no-cache
```

---

### Q4: æ•°æ®åº“è¿ç§»å‡ºé”™ï¼Ÿ

**ç­”**:
```bash
# å›æ»šè¿ç§»
alembic downgrade -1

# é‡æ–°ç”Ÿæˆè¿ç§»
alembic revision --autogenerate -m "description"
```

---

## é™„å½•

### æœ‰ç”¨çš„å‘½ä»¤

**åç«¯**:
```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ ¼å¼åŒ–
black app/
isort app/

# ç±»å‹æ£€æŸ¥
mypy app/
```

**å‰ç«¯**:
```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œæµ‹è¯•
npm test

# ä»£ç æ ¼å¼åŒ–
npm run lint -- --fix
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v0.1.0
**æœ€åæ›´æ–°**: 2026-01-13
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
